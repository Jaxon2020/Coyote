#!/usr/bin/env python3

import subprocess
import PySimpleGUI as sg
import nmap
from numpy import empty
import pandas as ps
import os
from shlex import *
import sqlite3 as sql
import parsedata


nmr = ps.read_csv('nmapdump.csv', sep = ';', header = 0)

adinforesults = 0
            
if adinforesults == 0:
    print("Checking for exploits based on nmap results.")
    try: 
        
        argsploit = "searchsploit"

        args1 = nmr['product'][0]

        args2 = nmr['version'][0]

        print(argsploit, args1, args2)
        output = subprocess.Popen([argsploit, str(args1), str(args2)], stdout=subprocess.PIPE).communicate()[0] 
        convertout = output.decode('utf-8')
    
        filetest = open('exploitdata.txt', 'w')
        filetest.write(str(convertout))
        filetest.close()

        print(parsedata.parsexdata())
    except:
        print("Error!")

elif adinforesults == 1:
    print("Checking for exploits based upon nmap results and additional submitted info.")
else:
    print("Checking for exploits based upon nmap results, web enumeration results, and additional submitted info.")
