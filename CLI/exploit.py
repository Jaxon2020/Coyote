#!/usr/bin/env python3

import subprocess
import PySimpleGUI as sg
import nmap
from numpy import empty
import pandas as ps
import os
from shlex import *
import sqlite3 as sql
import parsedata


nmr = ps.read_csv('nmapdump.csv', sep = ';', header = 0)

adinforesults = 0
            
if adinforesults == 0:
    print("Checking for exploits based on nmap results.")
    try: 
        
        argsploit = "searchsploit"
        print("The following are results that were found in the local nmap result file. Would you like to search for these, if not you must input your own args to pass to searchsploit!")
        oneorzero = input("Enter 1 for results and 0 for entering your own!: ")

        if oneorzero == 1:

            print(nmr['product'][0] + " " + nmr['version'][0])

            args1 = nmr['product'][0]

            args2 = nmr['version'][0]

            print(argsploit, args1, args2)
            output = subprocess.Popen([argsploit, str(args1), str(args2)], stdout=subprocess.PIPE).communicate()[0] 
            convertout = output.decode('utf-8')
        
            filetest = open('exploitdata.txt', 'w')
            filetest.write(str(convertout))
            filetest.close()

            print(parsedata.parsexdata())
        else:

            args1 = input("Enter Args1: ")

            args2 = input("Enter Args2: ")

            print(argsploit, args1, args2)
            output = subprocess.Popen([argsploit, str(args1), str(args2)], stdout=subprocess.PIPE).communicate()[0] 
            convertout = output.decode('utf-8')
        
            filetest = open('exploitdata.txt', 'w')
            filetest.write(str(convertout))
            filetest.close()

            print(parsedata.parsexdata())
    except:
        print("Error!")

elif adinforesults == 1:
    print("Checking for exploits based upon nmap results and additional submitted info.")
else:
    print("Checking for exploits based upon nmap results, web enumeration results, and additional submitted info.")
